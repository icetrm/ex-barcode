<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate Barcode</title>
    <meta name="description" content="Generate Barcode">
    <meta name="author" content="icetrm">
    <script src="JsBarcode.all.js" type="text/javascript"></script>
    <script src="bootstrap-5.3.3/js/bootstrap.js" type="text/javascript"></script>
    <link rel="stylesheet" href="bootstrap-5.3.3/css/bootstrap.css">
    <link rel="stylesheet" href="style.css">
</head>

<script type="text/javascript">
    var barcodeFormat = "CODE128";
    var barcodeStringFormat = "xxxxxxxxx-x";
    var barcodeValueStart = "0";
    var barcodeValueEnd = "1";
    var barcodeWidth = 2;
    var barcodeHeight = 100;

    window.onload = function () {
        renderBarcode(barcodeValueStart);
    }

    function removeNonNumericCharacters(string) {
        const nonNumericRegex = /[^0-9]/g;
        const cleanedString = string.replace(nonNumericRegex, '');
        return cleanedString;
    }

    function generateBarcode(format, value) {
        var regex = /x/g;
        var splitFormat = format.split('');
        
        value.split('').reverse().forEach(element => {
            var lastIndex = splitFormat.lastIndexOf('x');
            splitFormat[lastIndex] = element;
        });
        var result = splitFormat.join('').replace(regex, '0');
        // var result = format.replace(regex, '0').substring(0, format.length - value.length) + value;

        return result;
    }

    function onChangeFormat(value) {
        barcodeFormat = value;
        renderBarcode(barcodeValueStart);
    }

    function onChangeBarcodeValueStart(value) {
        barcodeValueStart = removeNonNumericCharacters(value);
        renderBarcode(barcodeValueStart);
    }

    function onChangeBarcodeValueEnd(value) {
        barcodeValueEnd = removeNonNumericCharacters(value);
    }

    function onChangeBarcodeWidth(value) {
        barcodeWidth = removeNonNumericCharacters(value);
        renderBarcode(barcodeValueStart);
    }

    function onChangeBarcodeHeight(value) {
        barcodeHeight = removeNonNumericCharacters(value);
        renderBarcode(barcodeValueStart);
    }

    function onChangeBarcodeStringFormat(value) {
        barcodeStringFormat = value;
        renderBarcode(barcodeValueStart);
    }

    function renderBarcode(value) {
        document.getElementById("barcodeValueStart").value = barcodeValueStart;
        document.getElementById("barcodeValueEnd").value = barcodeValueEnd;
        document.getElementById("barcodeStringFormat").value = barcodeStringFormat;
        document.getElementById("barcodeWidthValue").value = barcodeWidth;
        document.getElementById("barcodeHeightValue").value = barcodeHeight;

        JsBarcode("#barcode", generateBarcode(barcodeStringFormat, value), {
            format: barcodeFormat,
            width: barcodeWidth,
            height: barcodeHeight
        });

        // JsBarcode("#barcode", "123456789012");
        // JsBarcode("#barcode")
        //     .options({ font: "OCR-B" }) // Will affect all barcodes
        //     .EAN13("1234567890128", { fontSize: 18, textMargin: 0 })
        //     .blank(20) // Create space between the barcodes
        //     .EAN5("12345", { height: 85, textPosition: "top", fontSize: 16, marginTop: 15 })
        //     .render();
    }

    function onClickPrint() {
        window.print();
    }

    function onClickSubmit() {
        document.getElementById("preview").innerHTML = "";
        for (let i = parseInt(barcodeValueStart); i <= parseInt(barcodeValueEnd); i++) {
            renderBarcode(i.toString());
            const barcodeCopyElement = document.getElementById("barcode").cloneNode(true);
            barcodeCopyElement.id = "barcode" + i.toString();
            document.getElementById("preview").appendChild(barcodeCopyElement);
        }
    }
</script>

<body>
    <div class="container">
        <div class="barcode-wrapper">
            <svg id="barcode"></svg>
        </div>
        <div class="form-wrapper">
            <div class="form-floating mb-3">
                <select class="form-select" id="floatingSelect" aria-label="Floating label select example"
                    onchange="onChangeFormat(this.value)">
                    <option value="CODE128">CODE128</option>
                    <option value="CODE128A">CODE128A</option>
                    <option value="CODE128B">CODE128B</option>
                    <!-- <option value="UPCA">UPCA</option> -->
                    <!-- <option value="EAN13">EAN13</option> -->
                    <!-- <option value="EAN8">EAN8</option> -->
                    <!-- <option value="EAN5">EAN5</option> -->
                    <!-- <option value="EAN2">EAN2</option> -->
                    <!-- <option value="CODE39">CODE39</option>
                    <option value="ITF14">ITF14</option>
                    <option value="MSI">MSI</option>
                    <option value="MSI10">MSI10</option>
                    <option value="MSI11">MSI11</option>
                    <option value="MSI1010">MSI1010</option>
                    <option value="MSI1110">MSI1110</option>
                    <option value="pharmacode">pharmacode</option>
                    <option value="codabar">codabar</option> -->
                </select>
                <label for="floatingSelect">Barcode Type</label>
            </div>
            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="barcodeStringFormat" placeholder=""
                    onchange="onChangeBarcodeStringFormat(this.value)">
                <label for="barcodeStringFormat">Barcode String Format</label>
            </div>
            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="barcodeWidthValue" placeholder=""
                    onchange="onChangeBarcodeWidth(this.value)">
                <label for="barcodeWidthValue">Barcode Width</label>
            </div>
            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="barcodeHeightValue" placeholder=""
                    onchange="onChangeBarcodeHeight(this.value)">
                <label for="barcodeHeightValue">Barcode Height</label>
            </div>
            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="barcodeValueStart" placeholder=""
                    onchange="onChangeBarcodeValueStart(this.value)">
                <label for="barcodeValueStart">Start Value</label>
            </div>
            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="barcodeValueEnd" placeholder=""
                    onchange="onChangeBarcodeValueEnd(this.value)">
                <label for="barcodeValueEnd">End Value</label>
            </div>

            <div class="form-floating">
                <button type="button" class="btn btn-primary" onclick="onClickPrint()">Print</button>
                <button type="button" class="btn btn-primary" onclick="onClickSubmit()">Submit</button>
            </div>
        </div>
    </div>
    <div id="preview"></div>

</body>

</html>